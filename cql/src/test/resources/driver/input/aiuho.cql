set "streaming.storm.submit.islocal" = "true";

create input stream aiuhotest
(
TDRID String,
SYSID int,
ORGCDRID String,
ABISCDRID String,
ACDRID String,
HOREFID long,
ZONEID int,
POOLID int,
SCCPID String,
STARTTIME int,
MILLISEC int,
ABIS int,
SRVSTAT int,
CDRSTAT int,
HO_TYPE int,
INTER_TYPE int,
NI int,
OPC int,
DPC int,
LINKTYPE int,
ACCESS_TYPE int,
IMSI String,
TMSI String,
MSISDN String,
IMEI String,
MCC String,
MNC String,
ORGLAC String,
ORGCI String,
TMNC String,
TARGETLAC String,
TARGETCI String,
LastLAC String,
LastCI String,
ORGRNCID String,
TARRNCID String,
HOREFNUM int,
CODEC int,
IPADDR long,
PORT int,
HOLD int,
HO_CAUSE int,
FirstTEI int,
Firstchannel int,
SumRxlevlUL long,
SumRxlevlDL long,
SumRxqualUL long,
SumRxqualDL long,
SumBspwr long,
SumMspwr long,
SumTA long,
TotalMRno int,
TOTALMRCOUNT int,
TotalFullRateMRno int,
TotalHalfRateMRno int,
SumRxquaUL0 int,
SumRxquaUL1 int,
SumRxquaUL2 int,
SumRxquaUL3 int,
SumRxquaUL4 int,
SumRxquaUL5 int,
SumRxquaUL6 int,
SumRxquaUL7 int,
SumRxquaDL0 int,
SumRxquaDL1 int,
SumRxquaDL2 int,
SumRxquaDL3 int,
SumRxquaDL4 int,
SumRxquaDL5 int,
SumRxquaDL6 int,
SumRxquaDL7 int,
TA01Count int,
Rxlevel_Down int,
Weak_coverage int,
Over_coverage int,
Imbalance int,
Interference int,
HO_REQUIRED_TIME int,
HO_REQUEST_TIME int,
HO_ACK_TIME int,
HO_CMD_TIME int,
HO_DETECT_TIME int,
HO_COMPT_TIME int,
ASSN_TIME int,
ASSN_CMPT_TIME int,
ALERT_TIME int,
ANSWER_TIME int,
DIRECTION int,
HOCHARTYPE int,
HO_IN_FAIL_TIME int,
HO_OUT_FAIL_TIME int,
HO_OUT_REJECT_TIME int,
CLEAR_REQ_TIME int,
END_TIME int,
PD int,
FIRFAILMSG int,
CAUSE int,
ENCRYPT_VERSION int,
RESERVED1 string,
RESERVED2 string,
RESERVED3 string,
RESERVED4 long,
RESERVED5 int,
RESERVED6 int,
RESERVED7 int,
RESERVED8 int,
FILELOCATION string,
OFFSET int,
HOMEMCC string,
HOMEMNC string,
HOMEPROID int,
HOMEAREAID int,
PROBEID int,
PROBEID2 int,
GROUPID int,
LNKOPC int,
LNKDPC int,
LNKSRCIP long,
LNKSRCPORT int,
LNKDESTIP long,
LNKDESTPORT int,
Setup_time int,
AIuFirstXdrType int,
AfirstXdrID string,
MSCHOType int,
HOCallState int,
CallSrvType int,
HOINType int,
InitialMSC int,
InitialBSC int,
InitialMCC string,
InitialMNC string,
InitialLAC string,
InitialCI string,
InitialPOOLID int,
InitialAccess_Type int,
HOSourceMSC int,
HOSourceNI int,
HOSourcePOOLID int,
HOTargetMSC int,
HOTargetNI int,
HOTargetPOOLID int,
CALLDURATION int,
FIRFAILTIME int,
Layer1ID int,
Layer2ID int,
Layer3ID int,
Layer4ID int,
Layer5ID int,
Layer6ID int
)
 SERDE 'com.huawei.streaming.serde.AIUHOSerDe'
 SOURCE 'com.huawei.streaming.cql.toolkits.operators.TCPServerInputOperator'
 PROPERTIES ("operator.tcpserver.port" = "9999","operator.tcpserver.fixedlength"="883")
 parallel 1;

create output Stream rs
(
imsi string,
cnt long
)
  SERDE SimpleSerDe
  PROPERTIES ("serde.simpleserde.separator" = ",")
  SINK 'com.huawei.streaming.operator.outputstream.ConsolePrintOp'
  PROPERTIES("operator.consoleprint.frequence"="1")
; 

insert into rs select imsi, count(*) from aiuhotest(SRVSTAT = 1 and CAUSE in (0,1,2))[range 15 minutes slide] group by imsi having count(*) >= 20;

explain application aiuho;